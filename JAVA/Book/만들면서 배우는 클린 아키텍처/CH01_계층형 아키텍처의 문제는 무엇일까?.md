
## 01. 계층형 아키텍처의 문제는 무엇일까?

### 올바르게 구축 된 계층형 아키텍처란?
각 계층은 응집도가 높으면서 다른계층과는 낮은 결합도를 가지고있는 구조  
계층간의 구분을 잘 나누어 설계되었다면 재사용률도 올라가고 테스트 진행이 수월해진다.

### 계층형 아키텍처의 웹 애플리케이션 구조
웹 계층 → 도메인 계층 → 영속성 계층  
웹 계층은 도메인 계층에 의존하고 도메인 계층은 영속성 계층에 의존하기 때문에 자연스레 데이터베이스에 의존하게 된다. 이는 계층형 아키텍처의 ‘특정한 계층에서는 같은 계층에 있는 컴포넌트나 아래에 있는 계층만 접근하다’라는 유일한 규칙 때문이다.

**우리는 상태가 아니라 행동을 중심으로 모델링한다.**  
행동이 상태를 바꾸는 주체이기 때문이다.

### 계층형 아키텍처의 문제

**계층형 아키텍처는 많은 것들이 잘못된 방향으로 흘러가도록 용인한다. 아주 엄격한 자기 훈련 없이는 시간이 지날수록 품질이 저하되고 유지보수하기가 어려워진다.**
- 만약 계층에서 상위 계층에 위치한 컴포넌트에 접근해야 하는 일이 생겼다고 보자.  
  간단하게 접근해야 할 컴포넌트를 계층 아래로 내려버리면 깔끔하게 문제가 해결된다.  
  그러나 이런일을 대수롭지 않게 반복하다보면 영속성 계층(최하단 계층)은 비대해지게 된다.

- 혹은 로직이 거의 필요하지 않는 경우 웹계층에서 바로 영속성 계층에 접근하는 방식으로 사이 계층을 건너뛰어 사용할 수 있다. 이는 웹 계층이 도메인계층의 로직을 구현하게 되어 계층의 구분이 사라지게 되고 웹계층에서 도메인계층뿐 아닌 영속성 계층에도 의존성이 생겨 결합도가 높아진다.
    - 웹 계층을 테스트 할 시 도메인 계층만 아닌 영속성 계층도 모킹을 해야하는 경우가 발생하며 단위테스트의 복잡도가 올라가게 된다.

    - 이처럼 도메인 로직이 여러 계층에 걸쳐 흩어지기 쉬우며 나중에는 새로운 기능을 추가할 적당한 위치를 찾는 일은 이미 어려워진 상태가 된다.

- 계층형 아키텍처는 도메인 서비스의 너비에 관한 규칙을 강제하지 않는다.  
  도메인 계층의 서비스가 다양한 일을 담당하게 되어 넓은 서비스가 생성된다면 영속성 계층에 많은 의존성을 갖게 되고 다시 웹 레이어의 많은 컴포넌트가 이 서비스에 의존하게 된다.

  → 테스트하기도 어려워지고 작업해야 할 유스케이스를 책임지는 서비스를 찾기도 어려워진다.


<br/>

**동시작업의 어려움**  
**모든 상황에서 50명정도 되는 큰 규모의 개발팀이 10명 정도 되는 작은 규모의 개발팀보다 5배 빠를거라고 기대할 수는 없다.**

- 계층형 아키텍처는 모든 것이 영속성 계층 위에 만들어지기 때문에 영속성 계층을 먼저 개발해야 하고, 그 다음에 도메인 계층을, 그리고 마지막으로 웹 계층을 만들어야 한다. 그렇기 때문에 특정 기능은 동시에 한 명의 개발자만 작업할 수 있다.
- 데이터 주도 설계는 영속성 로직이 도메인 로직과 너무 뒤섞여서 각 측면을 개별적으로 작업할 수 없기 때문이다.
- 코드에 넓은 서비스가 있다면 서로 다른 기능을 동시에 작업하기가 더욱 어렵다.

<br/>

**해결방법?**  
도메인 로직을 먼저 만들어야 한다. 그래야만 우리가 로직을 제대로 이해했는지 확인 할 수 있다.  
그리고 도메인 로직이 맞다는 것을 확인한 후에 이를 기반으로 영속성계층과 웹 계층을 만들어야 한다.  

**희망사항**  
고도로 특화된 좁은 도메인 서비스가 유스케이스 하나씩만 담당하게 한다면 이런 작업들이 얼마나 수월해질까?