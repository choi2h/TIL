# 8장 경계 간 매핑하기

- 매핑 전략은 여러가지를 섞어쓸 수 있고, 섞어 써야만한다.
- 어떤 매핑 전략도 모든 계층에 걸쳐 전역 규칙일 필요가 없다.

<br/>

## 매핑하지 않기 전략
- 웹계층과 애플리케이션 계층, 영속성 계층 모두 하나의 도메인 모델에 접근하는 것을 의미한다.  
- 모든 계층이 같은 모델을 사용하니 계층 간 매핑을 할 필요가 없다.
- 단일 책임 원칙을 위반한다.
    - 웹 계층과 영속성 계층은 모데렝 대해 특별한 요구사항이 있을 수 있다. 
    - 도메인과 애플리케이션 계층은 이 요구사항에 관심이 없음에도 불구하고 이런 모든 요구사항을 다뤄야 한다.
- 모든 계층이 정확히 같은 구조의, 정확히 같은 정보를 필요로 한다면 이 전략은 완벽하다.
- 그러나 애프리케이션 계층이나 도메인 계층에서 웹과 영속성 문제를 다루게 되면 곧바로 다른 전략을 취해야 한다.

<br/>
<br/>

## 양방향 매핑하기 전략
- 웹 계층에서는 웹 모델을 인커밍 포트에서 필요한 도메인 모델로 매핑
- 인커밍 포트에 의해 반환된 도메인 객체를 다시 웹 모델로 매핑
- 영속성 계층은 아웃고잉 포트가 사용하는 도메인 모델과 영속성 모델 간의 매핑과 유사한 매핑을 담당한다.
- 두 계층 모두 양방향으로 매핑하기 때문에 '양방향' 매핑이라고 한다.
- 이 전략은 단일 책임 원칙을 만족한다.
    - 각 계층이 전용 모델을 가지고 있는 덕분에 전용 모델을 변경하더라도 다른 계층에 영향이 없다.
    - 웹이나 영속성 관심사로 오염되지 않은 깨끗한 도메인 모델로 이어진다.
    - 매핑의 책임이 명확하다.
- 그러나 너무 많은 보일러플레이트 코드가 생긴다.
- 또한, 도메인 모델이 계층 경계를 넘어서 통신하는데 사용되고 있다. 
    - 바깥쪽 계층의 요구에 따른 변경에 취약하다.

<br/>
<br/>

## 완전 매핑 전략
- 각 연산마다 별도의 입출력 모델을 사용한다.
- 계층 경계를 넘어 통신할 때 도메인 모델을 사용하는 대신 command 혹은 request 와 같은 단어로 표현된 특화된 모델을 사용한다.
- 각 유스케이스는 전용 필드와 유효성 검증 로직을 가진 전용 커맨드를 가진다.
- 어떤 필드를 비워두는 게 더 나은지 추측할 필요가 전혀 없다.  
값을 비워둘 수 있는 필드를 허용할 경우에는 현재의 유스케이스에서는 필요없는 유효성 검증이 수행될 수도 있기 때문이다.
- 여러 유스케이스의 요구사항을 함께 다뤄야 하는 매핑에 비해 구현하고 유지보수하기가 훨씬 쉽다.
- 전역 패턴으로는 추천하지 않는다.
- 애플리케이션 계층과 영속성 계층 사이에서는 매핑 오버헤드 때문에 사용하지 않는 것이 좋다.

<br/>
<br/>

## 단방향 매핑 전략
- 모든 계층의 모델들이 같은 인터페이스를 구현한다.
- 이 인터페이스는 관련 특성에 대한 getter 메서드를 제공해서 도메인 모델의 상태를 캡슐화한다.
- 실수로 도메인 객체의 상태를 변경하는 일은 발생하지 않는다.
    - 행동을 변경하는것이 상태 인터페이스에 의해 노출되지 않기 때문이다.
- 팩터리라는 DDD개념과 잘 어울린다. 
    - DDD용어인 팩터리는 어떤 특정한 상태로부터 도메인 객체를 재구성할 책임을 가진다.
- 매핑 책임은 명확하다.
    - 한 계층이 다른 계층으로부터 객체를 받으면 해당 계층에서 이용할 수 있도록 다른 무언가로 매핑하는 것이다.   
    -> 그러므로 각 계층은 한 방향으로만 매핑한다.
- 다른 전략에 비해 개념적으로 어렵다.
- 이 전략은 계층 간의 모델이 비슷할 때 가장 효과적이다.

<br/>
<br/>

## 언제 어떤 매핑 전략을 사용할 것인가?
- 그때그때 다르다.
- 언제 어떤 전략을 사용할지 결정하려면 팀 내에서 합의할 수 있는 가이드라인을 정해둬야 한다.
    - EX1. 변경 유스케이스를 작업하고 있다면 웹 계층과 애플리케이션 계층 사이에는 유스케이스 간의 결합을 제거하기 위해 '완전 매핑'전략을 첫번째 선택지로 택해야 한다.
    - EX2. 쿼리 작업을 한다면 매핑 오버헤드를 줄이고 빠르게 코드를 짜기 위해 매핑하지 않기 전략이 웹 계층과 애플리케이션 계층 사이, 애플리케이션 계층과 영속성 계층사이에서 첫 번째 선택지가 돼야 한다.

### 유지보수 가능한 소프트웨어에 도움
- 계층 사이에서 문지기처럼 동작하는 인커밍 포트와 아웃고잉 포트는 서로 다른 계층이 어떻게 통신해야 하는지를 정의한다. 
- 각 유스케이스에 대해 좁은 포트를 사용하자.
    - 유스케이스마다 다른 매핑 전략 사용이 가능하다.
    - 다른 유스케이스에 영향을 미치지 않으면서 코드 개선이 가능하다.
        - 특정 상황, 특정 시점에 최선의 전략을 선택할 수 있다.

